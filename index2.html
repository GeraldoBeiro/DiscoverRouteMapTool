<html>
<head>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src='https://unpkg.com/tesseract.js@v2.0.0-alpha.13/dist/tesseract.min.js'></script>
</head>
<body>




    <body>
        
        
        <center> 
<div>
        <select id="langsel">
            <option value='eng' selected> English </option>
            <option value='por' selected> English </option>
            
          </select>
          <input type="file" id="file-1" class="inputfile" />
          <img id="selected-image"  src="" />
          <div id="log">
              <span id="startPre">  
                  <a id="startLink" href="#">Click here to recognize text</a> or choose your own image
              </span>
          </div>

        </div>


    <div id="container">
    <video width="200" height="200" autoplay="true" id="video">
    </video>
    </div>
    <button onclick="capture()">Capture</button>  <br> </br>
    <canvas id="canvas" style="overflow:auto"></canvas>
    <br></br>
    <p> Image Converted to String: </p>
    <p id="printresult"></p>
    </center>


</body>
<script>


var video = document.querySelector("#video");
 if (navigator.mediaDevices.getUserMedia) {
   navigator.mediaDevices.getUserMedia({
       video: true
     })
     .then(function(stream) {
       video.srcObject = stream;
     })
     .catch(function(err0r) {
       console.log("Something went wrong!");
     });
 }
 var resultb64 = "";

 function capture() {
   var canvas = document.getElementById('canvas');
   var video = document.getElementById('video');
   canvas.width = 200;
   canvas.height = 200;
   canvas.getContext('2d').drawImage(video, 0, 0, 200, 200);
   resultb64 = canvas.toDataURL();
   document.getElementById("printresult").innerHTML = canvas.toDataURL();
 }
 document.getElementById("printresult").innerHTML = resultb64;

$("#file-1").change(function(a,b,c){

    console.log(a,b,c)
    const worker = new Tesseract.TesseractWorker();
worker.recognize($(this)[0].files[0], $("#langsel").val())
.progress(function(packet){
    console.info(packet)
    progressUpdate(packet)
})
.then(function(data){
    console.log(data)
    progressUpdate({ status: 'done', data: data })
})



})

function progressUpdate(packet){
    var log = document.getElementById('log');
 
    if(log.firstChild && log.firstChild.status === packet.status){
        if('progress' in packet){
            var progress = log.firstChild.querySelector('progress')
            progress.value = packet.progress
        }
    }else{
        var line = document.createElement('div');
        line.status = packet.status;
        var status = document.createElement('div')
        status.className = 'status'
        status.appendChild(document.createTextNode(packet.status))
        line.appendChild(status)
 
        if('progress' in packet){
            var progress = document.createElement('progress')
            progress.value = packet.progress
            progress.max = 1
            line.appendChild(progress)
        }
 
 
        if(packet.status == 'done'){
            log.innerHTML = ''
            var pre = document.createElement('pre')
            pre.appendChild(document.createTextNode(packet.data.text.replace(/\n\s*\n/g, '\n')))
            line.innerHTML = ''
            line.appendChild(pre)
            $(".fas").removeClass('fa-spinner fa-spin')
            $(".fas").addClass('fa-check')
        }
 
        log.insertBefore(line, log.firstChild)
    }
}
 
</script>

</html>